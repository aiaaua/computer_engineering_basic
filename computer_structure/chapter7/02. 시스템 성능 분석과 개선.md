# Multi Processor System Control

공유메모리 멀티프로세서 시스템에서는 각 자원의 효율적 분배와 상호 충돌을 배제할 수 있는 중재 프로세스가 필요



## System BUS and Local BUS

컴퓨터 시스템에는 각 요소들 사이의 정보 전송을 위한 다양한 단계의 여러 버스가 존재

CPU 내에서도 레지스터와 ALU 사이의 정보전송을 위한 여러 내부 버스가 존재

일반적으로 로컬버스를 컨트롤러에 의해 시스템버스에 연결하는 형태가 멀티프로세서 시스템의 형태



### System BUS

시스템 버스는 CPU, IOP(I/O Processor), Memory 와 같은 주요 요소를 연결하는 연결 체계



### Local BUS

로컬 버스는 다음과 같은 세 가지로 구성됨

- Memory BUS: 데이터, 주소, 읽기/쓰기 정보 전송
- I/O BUS: 입출력 장치로 정보 전송
- 통신전용 BUS: 특정 포트 정보, 해당 프로토콜 정보 등을 송/수신



## Control Algorithm

일반적으로 시스템 버스는 100여개의 신호라인으로 구성되며, 명령라인에 의해 중재 논리가 정립됨

- Daisy-Chain Control(직렬 중재 절차)

- Parallel Control(병렬 중재 논리)

- Dynamic Control(동적 중재 논리)



## Processor Communication

멀티 프로세서 시스템의 다양한 프로세서들은 공통의 입출력 채널을 통하여 서로 통신함



### Shared Memory

공유 메모리 멀티프로세서 시스템에서 메모리의 일부를 모든 프로세서가 접근할 수 있도록 할당한 공간

기본적으로 프로세서들 사이에 오가는 메세지의 집중지 역할을 함

주기적으로 체크하는 폴링방식 혹은 인터럽트 신호를 통하여 송신 프로세서가 수신 프로세서로 정보를 전달



### Multi Processor OS

- Master-Slave Mode(주종모드): 종 프로세서가 필요에 의해 주 프로세서(OS기능 수행)에게 인터럽트 요청
- Separate OS(분리 운영체제): 모든 프로세서가 자신의 운영체제를 가지고 운영, 느슨한 결합(loosely coupled)시스템에 적합한 형태
- Distributed OS(분산 운영체제): 부동 운영체제(OS의 특정 기능이 한 순간에 하나의 프로세서에서만 작동), 운영체제가 여러 프로세서에 분산되어있는 형태



### Process Synchronization

멀티 프로세서의 명령어 집합에는 함께 동작하는 프로세서와의 통신과 동기화를 구현하는 기본 명령어가 포함됨

처리될 작업들간의 정확한 순서를 유지하고 공용의 기록가능한 변수에 대한 상호배제적 접근을 보장하기 위해 동기화는 반드시 필요

멀티프로세서 시스템에서 자원의 동기화를 위해 가장 많이 활용되는 기법은 이진 세마포어를 이용하는 방법임



## Cache Coherence

공유 메모리 멀티프로세서 시스템에서도 각 프로세서는 로컬 메모리를 운영하는데

여러 개의 동일한 내용이 주기억장치나 각 로컬 메모리에 복사본으로 중복되어 저장되는 경우가 발생할 수 있으며 이 내용들이 모두 동일하게 유지되어야 함

따라서 `메모리 갱신 정책`이 필요하며 다음과 같이 두 종류가 있음

- write-through 정책: 쓰기동작의 발생 시 cache와 주 기억장치 모두를 갱신
- write-back 정책: cache만 갱신하고 다음에 메모리로 전달할 수 있도록 위치를 표시

cache의 일관성 문제는 각 프로세스별로 개별적인 cache를 가진 멀티프로세서에서 공통의 기록가능한 데이터가 필요하기 때문에 발생함

`cache의 일관성 문제에 대한 해결책`은 다음과 같은 방법들이 있음

- 각 프로세서에 개별적 cache를 허용하지 않고 주기억장치에 공용 cache 메모리를 둠(그러나 근접성 원리에 위배되며, 평균 데이터 접근시간을 증가시킨다는 단점이 있음)
- Cacheable(캐시가능) 방법은 비공유적이고 읽기전용 데이터에 한해서 cache에 저장되도록 함
- Snoopy Cache Controller(스누피 캐시 제어기)는 기본적으로 버스에 부착된 모든 cache에 대해 버스-감시 기능을 유지하도록 설계된 H/W 장치이며, cache에 write가 발생할 경우 메모리 갱신 정책에 따라 일관성을 유지